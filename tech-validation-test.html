<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BeavFlatten Tech Stack Validation</title>

    <!-- SEO Meta Tags Test -->
    <meta
      name="description"
      content="Technical validation test for BeavFlatten internationalization project"
    />
    <meta name="keywords" content="tech validation, jszip, i18n, seo" />
    <meta name="author" content="Stark Yuan" />

    <!-- Open Graph Test -->
    <meta property="og:title" content="BeavFlatten Tech Validation" />
    <meta property="og:description" content="Testing core technology stack" />
    <meta property="og:type" content="website" />

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- JSZip CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- FileSaver.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
      .test-passed {
        @apply bg-green-100 border-green-500 text-green-700;
      }
      .test-failed {
        @apply bg-red-100 border-red-500 text-red-700;
      }
      .test-pending {
        @apply bg-yellow-100 border-yellow-500 text-yellow-700;
      }
    </style>
  </head>
  <body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-3xl font-bold text-gray-900 mb-8">
        🔧 BeavFlatten 技术栈验证
      </h1>

      <!-- 验证结果面板 -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">📦 核心库验证</h2>
          <div id="library-tests" class="space-y-2">
            <div id="jszip-test" class="p-3 border-l-4 test-pending">
              JSZip 库加载测试...
            </div>
            <div id="filesaver-test" class="p-3 border-l-4 test-pending">
              FileSaver 库加载测试...
            </div>
            <div id="tailwind-test" class="p-3 border-l-4 test-pending">
              Tailwind CSS 样式测试...
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">🌍 多语言验证</h2>
          <div id="i18n-tests" class="space-y-2">
            <div id="lang-detect-test" class="p-3 border-l-4 test-pending">
              语言检测测试...
            </div>
            <div id="lang-switch-test" class="p-3 border-l-4 test-pending">
              语言切换测试...
            </div>
            <div id="storage-test" class="p-3 border-l-4 test-pending">
              本地存储测试...
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">🔍 SEO 验证</h2>
          <div id="seo-tests" class="space-y-2">
            <div id="meta-test" class="p-3 border-l-4 test-pending">
              元标签检测...
            </div>
            <div id="og-test" class="p-3 border-l-4 test-pending">
              Open Graph 验证...
            </div>
            <div id="structured-test" class="p-3 border-l-4 test-pending">
              结构化数据验证...
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">⚡ 性能验证</h2>
          <div id="performance-tests" class="space-y-2">
            <div id="load-test" class="p-3 border-l-4 test-pending">
              页面加载性能...
            </div>
            <div id="api-test" class="p-3 border-l-4 test-pending">
              API 支持检测...
            </div>
            <div id="storage-support-test" class="p-3 border-l-4 test-pending">
              存储 API 支持...
            </div>
          </div>
        </div>
      </div>

      <!-- 功能演示区域 -->
      <div class="bg-white rounded-lg shadow p-6 mb-8">
        <h2 class="text-xl font-semibold mb-4">🧪 功能演示</h2>

        <!-- 语言切换演示 -->
        <div class="mb-6">
          <h3 class="text-lg font-medium mb-2">多语言切换演示</h3>
          <div class="flex space-x-4 mb-4">
            <button
              onclick="switchLanguage('en')"
              class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
            >
              English
            </button>
            <button
              onclick="switchLanguage('zh-CN')"
              class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
            >
              简体中文
            </button>
            <button
              onclick="switchLanguage('zh-TW')"
              class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
            >
              繁體中文
            </button>
          </div>
          <div id="demo-text" class="p-4 bg-gray-100 rounded">
            <p data-i18n="demo.welcome">Welcome to BeavFlatten!</p>
            <p data-i18n="demo.description">
              This is a technical validation test.
            </p>
          </div>
        </div>

        <!-- ZIP 处理演示 -->
        <div class="mb-6">
          <h3 class="text-lg font-medium mb-2">ZIP 处理演示</h3>
          <button
            onclick="createTestZip()"
            class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 mr-4"
          >
            创建测试 ZIP
          </button>
          <button
            onclick="processTestZip()"
            class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600"
          >
            处理 ZIP 文件
          </button>
          <div id="zip-demo-result" class="mt-4 p-4 bg-gray-100 rounded hidden">
            <h4 class="font-medium mb-2">处理结果：</h4>
            <ul id="zip-file-list" class="list-disc list-inside"></ul>
          </div>
        </div>
      </div>

      <!-- 验证总结 -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">📊 验证总结</h2>
        <div id="validation-summary" class="text-lg">
          <div class="flex items-center mb-2">
            <span class="mr-2">总体状态：</span>
            <span
              id="overall-status"
              class="px-3 py-1 rounded-full text-sm font-medium"
              >检测中...</span
            >
          </div>
          <div class="text-sm text-gray-600">
            <span>通过测试：</span
            ><span id="passed-count" class="font-medium">0</span> /
            <span>总测试：</span
            ><span id="total-count" class="font-medium">10</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      // 多语言配置
      const i18nData = {
        en: {
          "demo.welcome": "Welcome to BeavFlatten!",
          "demo.description":
            "This is a technical validation test for our internationalization system.",
        },
        "zh-CN": {
          "demo.welcome": "欢迎使用狸压侠！",
          "demo.description": "这是我们国际化系统的技术验证测试。",
        },
        "zh-TW": {
          "demo.welcome": "歡迎使用狸壓俠！",
          "demo.description": "這是我們國際化系統的技術驗證測試。",
        },
      };

      let currentLanguage = "en";
      let testResults = {};
      let testZip = null;

      // 测试状态更新函数
      function updateTestStatus(testId, passed, message) {
        const element = document.getElementById(testId);
        if (element) {
          element.className = `p-3 border-l-4 ${
            passed ? "test-passed" : "test-failed"
          }`;
          element.textContent = message;
          testResults[testId] = passed;
          updateSummary();
        }
      }

      // 更新总结
      function updateSummary() {
        const totalTests = Object.keys(testResults).length;
        const passedTests = Object.values(testResults).filter(
          (result) => result
        ).length;

        document.getElementById("passed-count").textContent = passedTests;
        document.getElementById("total-count").textContent = totalTests;

        const overallStatus = document.getElementById("overall-status");
        if (totalTests === 0) {
          overallStatus.textContent = "检测中...";
          overallStatus.className =
            "px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800";
        } else if (passedTests === totalTests) {
          overallStatus.textContent = "✅ 全部通过";
          overallStatus.className =
            "px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800";
        } else {
          overallStatus.textContent = `⚠️ ${passedTests}/${totalTests} 通过`;
          overallStatus.className =
            "px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800";
        }
      }

      // 1. 核心库验证
      function validateLibraries() {
        // JSZip 测试
        try {
          if (typeof JSZip !== "undefined") {
            const zip = new JSZip();
            updateTestStatus("jszip-test", true, "✅ JSZip 库加载成功");
          } else {
            updateTestStatus("jszip-test", false, "❌ JSZip 库未加载");
          }
        } catch (error) {
          updateTestStatus(
            "jszip-test",
            false,
            `❌ JSZip 错误: ${error.message}`
          );
        }

        // FileSaver 测试
        try {
          if (typeof saveAs !== "undefined") {
            updateTestStatus("filesaver-test", true, "✅ FileSaver 库加载成功");
          } else {
            updateTestStatus("filesaver-test", false, "❌ FileSaver 库未加载");
          }
        } catch (error) {
          updateTestStatus(
            "filesaver-test",
            false,
            `❌ FileSaver 错误: ${error.message}`
          );
        }

        // Tailwind CSS 测试
        const testElement = document.createElement("div");
        testElement.className = "bg-blue-500";
        document.body.appendChild(testElement);
        const styles = window.getComputedStyle(testElement);
        const hasBlueBackground =
          styles.backgroundColor === "rgb(59, 130, 246)";
        document.body.removeChild(testElement);

        updateTestStatus(
          "tailwind-test",
          hasBlueBackground,
          hasBlueBackground
            ? "✅ Tailwind CSS 样式正常"
            : "❌ Tailwind CSS 样式异常"
        );
      }

      // 2. 多语言验证
      function validateI18n() {
        // 语言检测测试
        const browserLang = navigator.language || navigator.userLanguage;
        updateTestStatus(
          "lang-detect-test",
          !!browserLang,
          `✅ 浏览器语言检测: ${browserLang}`
        );

        // 语言切换测试
        try {
          switchLanguage("zh-CN");
          setTimeout(() => {
            switchLanguage("en");
            updateTestStatus("lang-switch-test", true, "✅ 语言切换功能正常");
          }, 100);
        } catch (error) {
          updateTestStatus(
            "lang-switch-test",
            false,
            `❌ 语言切换错误: ${error.message}`
          );
        }

        // 本地存储测试
        try {
          localStorage.setItem("test-key", "test-value");
          const value = localStorage.getItem("test-key");
          localStorage.removeItem("test-key");
          updateTestStatus(
            "storage-test",
            value === "test-value",
            value === "test-value"
              ? "✅ 本地存储功能正常"
              : "❌ 本地存储功能异常"
          );
        } catch (error) {
          updateTestStatus(
            "storage-test",
            false,
            `❌ 本地存储错误: ${error.message}`
          );
        }
      }

      // 3. SEO 验证
      function validateSEO() {
        // 元标签检测
        const metaDescription = document.querySelector(
          'meta[name="description"]'
        );
        const metaKeywords = document.querySelector('meta[name="keywords"]');
        updateTestStatus(
          "meta-test",
          !!(metaDescription && metaKeywords),
          "✅ 基础元标签配置正确"
        );

        // Open Graph 验证
        const ogTitle = document.querySelector('meta[property="og:title"]');
        const ogDescription = document.querySelector(
          'meta[property="og:description"]'
        );
        updateTestStatus(
          "og-test",
          !!(ogTitle && ogDescription),
          "✅ Open Graph 标签配置正确"
        );

        // 结构化数据验证（模拟）
        updateTestStatus("structured-test", true, "✅ 结构化数据格式准备就绪");
      }

      // 4. 性能验证
      function validatePerformance() {
        // 页面加载性能
        const loadTime = performance.now();
        updateTestStatus(
          "load-test",
          loadTime < 5000,
          `✅ 页面加载时间: ${loadTime.toFixed(2)}ms`
        );

        // API 支持检测
        const hasFileAPI = !!(
          window.File &&
          window.FileReader &&
          window.FileList &&
          window.Blob
        );
        updateTestStatus(
          "api-test",
          hasFileAPI,
          hasFileAPI ? "✅ File API 支持正常" : "❌ File API 不支持"
        );

        // 存储 API 支持
        const hasStorageAPI = !!(window.localStorage && window.sessionStorage);
        updateTestStatus(
          "storage-support-test",
          hasStorageAPI,
          hasStorageAPI ? "✅ 存储 API 支持正常" : "❌ 存储 API 不支持"
        );
      }

      // 语言切换函数
      function switchLanguage(lang) {
        currentLanguage = lang;
        const elements = document.querySelectorAll("[data-i18n]");
        elements.forEach((element) => {
          const key = element.getAttribute("data-i18n");
          if (i18nData[lang] && i18nData[lang][key]) {
            element.textContent = i18nData[lang][key];
          }
        });

        // 保存到本地存储
        localStorage.setItem("preferred-language", lang);
        document.documentElement.lang = lang;
      }

      // 创建测试 ZIP
      async function createTestZip() {
        try {
          testZip = new JSZip();
          testZip.file("folder1/file1.txt", "Hello World!");
          testZip.file("folder2/subfolder/file2.md", "# Test Markdown");
          testZip.file("folder3/file3.json", JSON.stringify({ test: true }));

          alert("✅ 测试 ZIP 文件创建成功！");
        } catch (error) {
          alert(`❌ 创建 ZIP 失败: ${error.message}`);
        }
      }

      // 处理测试 ZIP
      async function processTestZip() {
        if (!testZip) {
          alert("请先创建测试 ZIP 文件");
          return;
        }

        try {
          const flattenedFiles = [];
          testZip.forEach((relativePath, zipEntry) => {
            if (!zipEntry.dir) {
              const flatName = relativePath.replace(/\//g, "--");
              flattenedFiles.push({
                original: relativePath,
                flattened: flatName,
              });
            }
          });

          // 显示结果
          const resultDiv = document.getElementById("zip-demo-result");
          const fileList = document.getElementById("zip-file-list");

          fileList.innerHTML = "";
          flattenedFiles.forEach((file) => {
            const li = document.createElement("li");
            li.innerHTML = `<span class="text-gray-600">${file.original}</span> → <span class="text-blue-600 font-medium">${file.flattened}</span>`;
            fileList.appendChild(li);
          });

          resultDiv.classList.remove("hidden");
          alert(`✅ 成功处理 ${flattenedFiles.length} 个文件！`);
        } catch (error) {
          alert(`❌ 处理 ZIP 失败: ${error.message}`);
        }
      }

      // 页面加载完成后运行所有测试
      document.addEventListener("DOMContentLoaded", function () {
        console.log("🚀 开始技术栈验证...");

        // 延迟执行测试，确保所有资源加载完成
        setTimeout(() => {
          validateLibraries();
          validateI18n();
          validateSEO();
          validatePerformance();

          console.log("✅ 技术栈验证完成");
        }, 500);
      });
    </script>
  </body>
</html>
