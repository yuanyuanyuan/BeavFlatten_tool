<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BeavFlatten Tech Stack Validation</title>

    <!-- SEO Meta Tags Test -->
    <meta
      name="description"
      content="Technical validation test for BeavFlatten internationalization project"
    />
    <meta name="keywords" content="tech validation, jszip, i18n, seo" />
    <meta name="author" content="Stark Yuan" />

    <!-- Open Graph Test -->
    <meta property="og:title" content="BeavFlatten Tech Validation" />
    <meta property="og:description" content="Testing core technology stack" />
    <meta property="og:type" content="website" />

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- JSZip CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- FileSaver.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
      .test-passed {
        @apply bg-green-100 border-green-500 text-green-700;
      }
      .test-failed {
        @apply bg-red-100 border-red-500 text-red-700;
      }
      .test-pending {
        @apply bg-yellow-100 border-yellow-500 text-yellow-700;
      }
    </style>
  </head>
  <body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-3xl font-bold text-gray-900 mb-8">
        ğŸ”§ BeavFlatten æŠ€æœ¯æ ˆéªŒè¯
      </h1>

      <!-- éªŒè¯ç»“æœé¢æ¿ -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">ğŸ“¦ æ ¸å¿ƒåº“éªŒè¯</h2>
          <div id="library-tests" class="space-y-2">
            <div id="jszip-test" class="p-3 border-l-4 test-pending">
              JSZip åº“åŠ è½½æµ‹è¯•...
            </div>
            <div id="filesaver-test" class="p-3 border-l-4 test-pending">
              FileSaver åº“åŠ è½½æµ‹è¯•...
            </div>
            <div id="tailwind-test" class="p-3 border-l-4 test-pending">
              Tailwind CSS æ ·å¼æµ‹è¯•...
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">ğŸŒ å¤šè¯­è¨€éªŒè¯</h2>
          <div id="i18n-tests" class="space-y-2">
            <div id="lang-detect-test" class="p-3 border-l-4 test-pending">
              è¯­è¨€æ£€æµ‹æµ‹è¯•...
            </div>
            <div id="lang-switch-test" class="p-3 border-l-4 test-pending">
              è¯­è¨€åˆ‡æ¢æµ‹è¯•...
            </div>
            <div id="storage-test" class="p-3 border-l-4 test-pending">
              æœ¬åœ°å­˜å‚¨æµ‹è¯•...
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">ğŸ” SEO éªŒè¯</h2>
          <div id="seo-tests" class="space-y-2">
            <div id="meta-test" class="p-3 border-l-4 test-pending">
              å…ƒæ ‡ç­¾æ£€æµ‹...
            </div>
            <div id="og-test" class="p-3 border-l-4 test-pending">
              Open Graph éªŒè¯...
            </div>
            <div id="structured-test" class="p-3 border-l-4 test-pending">
              ç»“æ„åŒ–æ•°æ®éªŒè¯...
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-xl font-semibold mb-4">âš¡ æ€§èƒ½éªŒè¯</h2>
          <div id="performance-tests" class="space-y-2">
            <div id="load-test" class="p-3 border-l-4 test-pending">
              é¡µé¢åŠ è½½æ€§èƒ½...
            </div>
            <div id="api-test" class="p-3 border-l-4 test-pending">
              API æ”¯æŒæ£€æµ‹...
            </div>
            <div id="storage-support-test" class="p-3 border-l-4 test-pending">
              å­˜å‚¨ API æ”¯æŒ...
            </div>
          </div>
        </div>
      </div>

      <!-- åŠŸèƒ½æ¼”ç¤ºåŒºåŸŸ -->
      <div class="bg-white rounded-lg shadow p-6 mb-8">
        <h2 class="text-xl font-semibold mb-4">ğŸ§ª åŠŸèƒ½æ¼”ç¤º</h2>

        <!-- è¯­è¨€åˆ‡æ¢æ¼”ç¤º -->
        <div class="mb-6">
          <h3 class="text-lg font-medium mb-2">å¤šè¯­è¨€åˆ‡æ¢æ¼”ç¤º</h3>
          <div class="flex space-x-4 mb-4">
            <button
              onclick="switchLanguage('en')"
              class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
            >
              English
            </button>
            <button
              onclick="switchLanguage('zh-CN')"
              class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
            >
              ç®€ä½“ä¸­æ–‡
            </button>
            <button
              onclick="switchLanguage('zh-TW')"
              class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
            >
              ç¹é«”ä¸­æ–‡
            </button>
          </div>
          <div id="demo-text" class="p-4 bg-gray-100 rounded">
            <p data-i18n="demo.welcome">Welcome to BeavFlatten!</p>
            <p data-i18n="demo.description">
              This is a technical validation test.
            </p>
          </div>
        </div>

        <!-- ZIP å¤„ç†æ¼”ç¤º -->
        <div class="mb-6">
          <h3 class="text-lg font-medium mb-2">ZIP å¤„ç†æ¼”ç¤º</h3>
          <button
            onclick="createTestZip()"
            class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 mr-4"
          >
            åˆ›å»ºæµ‹è¯• ZIP
          </button>
          <button
            onclick="processTestZip()"
            class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600"
          >
            å¤„ç† ZIP æ–‡ä»¶
          </button>
          <div id="zip-demo-result" class="mt-4 p-4 bg-gray-100 rounded hidden">
            <h4 class="font-medium mb-2">å¤„ç†ç»“æœï¼š</h4>
            <ul id="zip-file-list" class="list-disc list-inside"></ul>
          </div>
        </div>
      </div>

      <!-- éªŒè¯æ€»ç»“ -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">ğŸ“Š éªŒè¯æ€»ç»“</h2>
        <div id="validation-summary" class="text-lg">
          <div class="flex items-center mb-2">
            <span class="mr-2">æ€»ä½“çŠ¶æ€ï¼š</span>
            <span
              id="overall-status"
              class="px-3 py-1 rounded-full text-sm font-medium"
              >æ£€æµ‹ä¸­...</span
            >
          </div>
          <div class="text-sm text-gray-600">
            <span>é€šè¿‡æµ‹è¯•ï¼š</span
            ><span id="passed-count" class="font-medium">0</span> /
            <span>æ€»æµ‹è¯•ï¼š</span
            ><span id="total-count" class="font-medium">10</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      // å¤šè¯­è¨€é…ç½®
      const i18nData = {
        en: {
          "demo.welcome": "Welcome to BeavFlatten!",
          "demo.description":
            "This is a technical validation test for our internationalization system.",
        },
        "zh-CN": {
          "demo.welcome": "æ¬¢è¿ä½¿ç”¨ç‹¸å‹ä¾ ï¼",
          "demo.description": "è¿™æ˜¯æˆ‘ä»¬å›½é™…åŒ–ç³»ç»Ÿçš„æŠ€æœ¯éªŒè¯æµ‹è¯•ã€‚",
        },
        "zh-TW": {
          "demo.welcome": "æ­¡è¿ä½¿ç”¨ç‹¸å£“ä¿ ï¼",
          "demo.description": "é€™æ˜¯æˆ‘å€‘åœ‹éš›åŒ–ç³»çµ±çš„æŠ€è¡“é©—è­‰æ¸¬è©¦ã€‚",
        },
      };

      let currentLanguage = "en";
      let testResults = {};
      let testZip = null;

      // æµ‹è¯•çŠ¶æ€æ›´æ–°å‡½æ•°
      function updateTestStatus(testId, passed, message) {
        const element = document.getElementById(testId);
        if (element) {
          element.className = `p-3 border-l-4 ${
            passed ? "test-passed" : "test-failed"
          }`;
          element.textContent = message;
          testResults[testId] = passed;
          updateSummary();
        }
      }

      // æ›´æ–°æ€»ç»“
      function updateSummary() {
        const totalTests = Object.keys(testResults).length;
        const passedTests = Object.values(testResults).filter(
          (result) => result
        ).length;

        document.getElementById("passed-count").textContent = passedTests;
        document.getElementById("total-count").textContent = totalTests;

        const overallStatus = document.getElementById("overall-status");
        if (totalTests === 0) {
          overallStatus.textContent = "æ£€æµ‹ä¸­...";
          overallStatus.className =
            "px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800";
        } else if (passedTests === totalTests) {
          overallStatus.textContent = "âœ… å…¨éƒ¨é€šè¿‡";
          overallStatus.className =
            "px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800";
        } else {
          overallStatus.textContent = `âš ï¸ ${passedTests}/${totalTests} é€šè¿‡`;
          overallStatus.className =
            "px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800";
        }
      }

      // 1. æ ¸å¿ƒåº“éªŒè¯
      function validateLibraries() {
        // JSZip æµ‹è¯•
        try {
          if (typeof JSZip !== "undefined") {
            const zip = new JSZip();
            updateTestStatus("jszip-test", true, "âœ… JSZip åº“åŠ è½½æˆåŠŸ");
          } else {
            updateTestStatus("jszip-test", false, "âŒ JSZip åº“æœªåŠ è½½");
          }
        } catch (error) {
          updateTestStatus(
            "jszip-test",
            false,
            `âŒ JSZip é”™è¯¯: ${error.message}`
          );
        }

        // FileSaver æµ‹è¯•
        try {
          if (typeof saveAs !== "undefined") {
            updateTestStatus("filesaver-test", true, "âœ… FileSaver åº“åŠ è½½æˆåŠŸ");
          } else {
            updateTestStatus("filesaver-test", false, "âŒ FileSaver åº“æœªåŠ è½½");
          }
        } catch (error) {
          updateTestStatus(
            "filesaver-test",
            false,
            `âŒ FileSaver é”™è¯¯: ${error.message}`
          );
        }

        // Tailwind CSS æµ‹è¯•
        const testElement = document.createElement("div");
        testElement.className = "bg-blue-500";
        document.body.appendChild(testElement);
        const styles = window.getComputedStyle(testElement);
        const hasBlueBackground =
          styles.backgroundColor === "rgb(59, 130, 246)";
        document.body.removeChild(testElement);

        updateTestStatus(
          "tailwind-test",
          hasBlueBackground,
          hasBlueBackground
            ? "âœ… Tailwind CSS æ ·å¼æ­£å¸¸"
            : "âŒ Tailwind CSS æ ·å¼å¼‚å¸¸"
        );
      }

      // 2. å¤šè¯­è¨€éªŒè¯
      function validateI18n() {
        // è¯­è¨€æ£€æµ‹æµ‹è¯•
        const browserLang = navigator.language || navigator.userLanguage;
        updateTestStatus(
          "lang-detect-test",
          !!browserLang,
          `âœ… æµè§ˆå™¨è¯­è¨€æ£€æµ‹: ${browserLang}`
        );

        // è¯­è¨€åˆ‡æ¢æµ‹è¯•
        try {
          switchLanguage("zh-CN");
          setTimeout(() => {
            switchLanguage("en");
            updateTestStatus("lang-switch-test", true, "âœ… è¯­è¨€åˆ‡æ¢åŠŸèƒ½æ­£å¸¸");
          }, 100);
        } catch (error) {
          updateTestStatus(
            "lang-switch-test",
            false,
            `âŒ è¯­è¨€åˆ‡æ¢é”™è¯¯: ${error.message}`
          );
        }

        // æœ¬åœ°å­˜å‚¨æµ‹è¯•
        try {
          localStorage.setItem("test-key", "test-value");
          const value = localStorage.getItem("test-key");
          localStorage.removeItem("test-key");
          updateTestStatus(
            "storage-test",
            value === "test-value",
            value === "test-value"
              ? "âœ… æœ¬åœ°å­˜å‚¨åŠŸèƒ½æ­£å¸¸"
              : "âŒ æœ¬åœ°å­˜å‚¨åŠŸèƒ½å¼‚å¸¸"
          );
        } catch (error) {
          updateTestStatus(
            "storage-test",
            false,
            `âŒ æœ¬åœ°å­˜å‚¨é”™è¯¯: ${error.message}`
          );
        }
      }

      // 3. SEO éªŒè¯
      function validateSEO() {
        // å…ƒæ ‡ç­¾æ£€æµ‹
        const metaDescription = document.querySelector(
          'meta[name="description"]'
        );
        const metaKeywords = document.querySelector('meta[name="keywords"]');
        updateTestStatus(
          "meta-test",
          !!(metaDescription && metaKeywords),
          "âœ… åŸºç¡€å…ƒæ ‡ç­¾é…ç½®æ­£ç¡®"
        );

        // Open Graph éªŒè¯
        const ogTitle = document.querySelector('meta[property="og:title"]');
        const ogDescription = document.querySelector(
          'meta[property="og:description"]'
        );
        updateTestStatus(
          "og-test",
          !!(ogTitle && ogDescription),
          "âœ… Open Graph æ ‡ç­¾é…ç½®æ­£ç¡®"
        );

        // ç»“æ„åŒ–æ•°æ®éªŒè¯ï¼ˆæ¨¡æ‹Ÿï¼‰
        updateTestStatus("structured-test", true, "âœ… ç»“æ„åŒ–æ•°æ®æ ¼å¼å‡†å¤‡å°±ç»ª");
      }

      // 4. æ€§èƒ½éªŒè¯
      function validatePerformance() {
        // é¡µé¢åŠ è½½æ€§èƒ½
        const loadTime = performance.now();
        updateTestStatus(
          "load-test",
          loadTime < 5000,
          `âœ… é¡µé¢åŠ è½½æ—¶é—´: ${loadTime.toFixed(2)}ms`
        );

        // API æ”¯æŒæ£€æµ‹
        const hasFileAPI = !!(
          window.File &&
          window.FileReader &&
          window.FileList &&
          window.Blob
        );
        updateTestStatus(
          "api-test",
          hasFileAPI,
          hasFileAPI ? "âœ… File API æ”¯æŒæ­£å¸¸" : "âŒ File API ä¸æ”¯æŒ"
        );

        // å­˜å‚¨ API æ”¯æŒ
        const hasStorageAPI = !!(window.localStorage && window.sessionStorage);
        updateTestStatus(
          "storage-support-test",
          hasStorageAPI,
          hasStorageAPI ? "âœ… å­˜å‚¨ API æ”¯æŒæ­£å¸¸" : "âŒ å­˜å‚¨ API ä¸æ”¯æŒ"
        );
      }

      // è¯­è¨€åˆ‡æ¢å‡½æ•°
      function switchLanguage(lang) {
        currentLanguage = lang;
        const elements = document.querySelectorAll("[data-i18n]");
        elements.forEach((element) => {
          const key = element.getAttribute("data-i18n");
          if (i18nData[lang] && i18nData[lang][key]) {
            element.textContent = i18nData[lang][key];
          }
        });

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        localStorage.setItem("preferred-language", lang);
        document.documentElement.lang = lang;
      }

      // åˆ›å»ºæµ‹è¯• ZIP
      async function createTestZip() {
        try {
          testZip = new JSZip();
          testZip.file("folder1/file1.txt", "Hello World!");
          testZip.file("folder2/subfolder/file2.md", "# Test Markdown");
          testZip.file("folder3/file3.json", JSON.stringify({ test: true }));

          alert("âœ… æµ‹è¯• ZIP æ–‡ä»¶åˆ›å»ºæˆåŠŸï¼");
        } catch (error) {
          alert(`âŒ åˆ›å»º ZIP å¤±è´¥: ${error.message}`);
        }
      }

      // å¤„ç†æµ‹è¯• ZIP
      async function processTestZip() {
        if (!testZip) {
          alert("è¯·å…ˆåˆ›å»ºæµ‹è¯• ZIP æ–‡ä»¶");
          return;
        }

        try {
          const flattenedFiles = [];
          testZip.forEach((relativePath, zipEntry) => {
            if (!zipEntry.dir) {
              const flatName = relativePath.replace(/\//g, "--");
              flattenedFiles.push({
                original: relativePath,
                flattened: flatName,
              });
            }
          });

          // æ˜¾ç¤ºç»“æœ
          const resultDiv = document.getElementById("zip-demo-result");
          const fileList = document.getElementById("zip-file-list");

          fileList.innerHTML = "";
          flattenedFiles.forEach((file) => {
            const li = document.createElement("li");
            li.innerHTML = `<span class="text-gray-600">${file.original}</span> â†’ <span class="text-blue-600 font-medium">${file.flattened}</span>`;
            fileList.appendChild(li);
          });

          resultDiv.classList.remove("hidden");
          alert(`âœ… æˆåŠŸå¤„ç† ${flattenedFiles.length} ä¸ªæ–‡ä»¶ï¼`);
        } catch (error) {
          alert(`âŒ å¤„ç† ZIP å¤±è´¥: ${error.message}`);
        }
      }

      // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæ‰€æœ‰æµ‹è¯•
      document.addEventListener("DOMContentLoaded", function () {
        console.log("ğŸš€ å¼€å§‹æŠ€æœ¯æ ˆéªŒè¯...");

        // å»¶è¿Ÿæ‰§è¡Œæµ‹è¯•ï¼Œç¡®ä¿æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ
        setTimeout(() => {
          validateLibraries();
          validateI18n();
          validateSEO();
          validatePerformance();

          console.log("âœ… æŠ€æœ¯æ ˆéªŒè¯å®Œæˆ");
        }, 500);
      });
    </script>
  </body>
</html>
